<!DOCTYPE html>
  
  
  
  
   <html class="no-js"> 

  <head lang="en-us">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=10" />
    <title>Resource Authors Guide - Converge</title>
    <meta name="generator" content="Hugo 0.16" />

    
    <meta name="description" content="graph your configurations!">
    
    <link rel="canonical" href="http://converge.aster.is/resource-authors-guide/">
    
    <meta name="author" content="Converge">
    

    <meta property="og:url" content="http://converge.aster.is/resource-authors-guide/">
    <meta property="og:title" content="Converge">
    <meta property="og:image" content="http://converge.aster.is/images/logo.png">
    <meta name="apple-mobile-web-app-title" content="Converge">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="shortcut icon" type="image/x-icon" href="http://converge.aster.is/images/favicon.ico">
    <link rel="icon" type="image/x-icon" href="http://converge.aster.is/images/favicon.ico">

    <style>
      @font-face {
        font-family: 'Icon';
        src: url('http://converge.aster.is/fonts/icon.eot?52m981');
        src: url('http://converge.aster.is/fonts/icon.eot?#iefix52m981')
               format('embedded-opentype'),
             url('http://converge.aster.is/fonts/icon.woff?52m981')
               format('woff'),
             url('http://converge.aster.is/fonts/icon.ttf?52m981')
               format('truetype'),
             url('http://converge.aster.is/fonts/icon.svg?52m981#icon')
               format('svg');
        font-weight: normal;
        font-style: normal;
      }
    </style>

    <link rel="stylesheet" href="http://converge.aster.is/stylesheets/application.css">
    <link rel="stylesheet" href="http://converge.aster.is/stylesheets/temporary.css">
    <link rel="stylesheet" href="http://converge.aster.is/stylesheets/palettes.css">
    <link rel="stylesheet" href="http://converge.aster.is/stylesheets/highlight/highlight.css">

    
    
    
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ubuntu:400,700|Ubuntu%2bMono">
    <style>
      body, input {
        font-family: 'Ubuntu', Helvetica, Arial, sans-serif;
      }
      pre, code {
        font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
      }
    </style>

    
    <script src="http://converge.aster.is/javascripts/modernizr.js"></script>

    

  </head>
  <body class="palette-primary-indigo palette-accent-teal">



	
	


<div class="backdrop">
	<div class="backdrop-paper"></div>
</div>

<input class="toggle" type="checkbox" id="toggle-drawer">
<input class="toggle" type="checkbox" id="toggle-search">
<label class="toggle-button overlay" for="toggle-drawer"></label>

<header class="header">
	<nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        Resource Authors Guide
      </div>
    </div>

    
    <div class="button button-twitter" role="button" aria-label="Twitter">
       <a href="https://twitter.com/asteris_llc" title="@asteris_llc on Twitter" target="_blank" class="toggle-button icon icon-twitter"></a>
    </div>
    

    
    <div class="button button-github" role="button" aria-label="GitHub">
      <a href="https://github.com/asteris-llc" title="@asteris-llc on GitHub" target="_blank" class="toggle-button icon icon-github"></a>
    </div>
    
    
        
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
</header>

<main class="main">
	<div class="drawer">
		<nav aria-label="Navigation">
  <a href="https://github.com/asteris-llc/converge" class="project">
    <div class="banner">
      
        <div class="logo">
          <img src="http://converge.aster.is/images/logo.png">
        </div>
      
      <div class="name">
        <strong>Converge <span class="version">0.3.0</span></strong>
        
          <br>
          asteris-llc/converge
        
      </div>
    </div>
  </a>

  <div class="scrollable">
    <div class="wrapper">
      
        <ul class="repo">
          <li class="repo-download">
            <a href="https://github.com/asteris-llc/converge/archive/master.zip" target="_blank" title="Download" data-action="download">
              <i class="icon icon-download"></i> Download
            </a>
          </li>
          <li class="repo-stars">
            <a href="https://github.com/asteris-llc/converge/stargazers" target="_blank" title="Stargazers" data-action="star">
              <i class="icon icon-star"></i> Stars
              <span class="count">&ndash;</span>
            </a>
          </li>
        </ul>
        <hr>
      

      <div class="toc">
        
        <ul>
          




<li>
    



<a  title="Converge" href="http://converge.aster.is/">
  
  Converge
</a>



    
    <ul>
        
        
        



<a  title="Install" href="http://converge.aster.is/install/">
  
  Install
</a>



        
        
        



<a  title="Getting Started" href="http://converge.aster.is/getting-started/">
  
  Getting Started
</a>



        
        
        



<a  title="Module Verification" href="http://converge.aster.is/module-verification/">
  
  Module Verification
</a>



        
        
        



<a  title="Using Dependencies" href="http://converge.aster.is/dependencies/">
  
  Using Dependencies
</a>



        
        
        



<a  title="Server" href="http://converge.aster.is/server/">
  
  Server
</a>



        
        
        



<a  title="Configuration" href="http://converge.aster.is/configuration/">
  
  Configuration
</a>



        
        
        



<a class="current" title="Resource Authors Guide" href="http://converge.aster.is/resource-authors-guide/">
  
  Resource Authors Guide
</a>


<ul id="scrollspy">
</ul>


        
    </ul>
    
</li>



<li>
    



<a  title="License" href="http://converge.aster.is/license/">
  
  License
</a>



    
</li>



<li>
    



<a  title="Resource Reference" href="http://converge.aster.is/resources/">
  
  Resource Reference
</a>



    
    <ul>
        
        
        



<a  title="docker.container" href="http://converge.aster.is/resources/docker-container/">
  
  docker.container
</a>



        
        
        



<a  title="docker.image" href="http://converge.aster.is/resources/docker-image/">
  
  docker.image
</a>



        
        
        



<a  title="file.content" href="http://converge.aster.is/resources/file-content/">
  
  file.content
</a>



        
        
        



<a  title="file.directory" href="http://converge.aster.is/resources/file-directory/">
  
  file.directory
</a>



        
        
        



<a  title="file.mode" href="http://converge.aster.is/resources/file-mode/">
  
  file.mode
</a>



        
        
        



<a  title="module" href="http://converge.aster.is/resources/module/">
  
  module
</a>



        
        
        



<a  title="param" href="http://converge.aster.is/resources/param/">
  
  param
</a>



        
        
        



<a  title="task" href="http://converge.aster.is/resources/task/">
  
  task
</a>



        
        
        



<a  title="task.query" href="http://converge.aster.is/resources/task-query/">
  
  task.query
</a>



        
        
        



<a  title="user.group" href="http://converge.aster.is/resources/user-group/">
  
  user.group
</a>



        
        
        



<a  title="user.user" href="http://converge.aster.is/resources/user-user/">
  
  user.user
</a>



        
    </ul>
    
</li>


        </ul>
        

        
        <hr>
        <span class="section">The author</span>
        
        <ul>
          
          <li>
            <a href="https://twitter.com/asteris_llc" target="_blank" title="@asteris_llc on Twitter">
              @asteris_llc on Twitter
            </a>
          </li>
          

          
          <li>
            <a href="https://github.com/asteris-llc" target="_blank" title="@asteris-llc on GitHub">
              @asteris-llc on GitHub
            </a>
          </li>
          
        </ul>
        
      </div>
    </div>
  </div>
</nav>

	</div>

	<article class="article">
		<div class="wrapper">
			<h1>Resource Authors Guide </h1>

			

<div class="admonition warning">
<p class="admonition-title">Advanced Topic</p>
<p>This is something most people will never have to do. That said, if you know why
you&rsquo;re here, read on&hellip;</p>
</div>

<h2 id="contributing-resources">Contributing Resources</h2>

<p>We welcome external resource contributions, and can help you plan out how your
resource will work. If you have an idea for a new module, please open an issue
on Converge and we&rsquo;ll help you figure out exactly how to develop it. We&rsquo;ll also
gladly help you with documentation and getting everything imported in the right
places. Converge modules must currently be included in the main source of
Converge, we hope to be able to make them external at some point in the future
(at which point external contributions become even easier!)</p>

<h2 id="check-and-apply">Check and Apply</h2>

<p>Converge resources have a basic pattern: two operations, check and apply. This
pattern is most obvious in the shell task resource:</p>

<pre><code class="language-hcl">task &quot;example&quot; {
  check = &quot;test -f hello.txt&quot;
  apply = &quot;touch hello.txt&quot;
}
</code></pre>

<p>When Converge applies this resource, the check statement is run first. If the
exit code is non-zero, Converge then runs the apply statement. Afterwards, it
runs the check statement again to see if the application was successful.</p>

<p>To implement something like the shell task, you would start by implementing a
struct and it&rsquo;s corresponding methods.
<a href="https://godoc.org/github.com/asteris-llc/converge/resource#Task"><code>resource.Task</code></a>
is the interface you&rsquo;ll need to implement.</p>

<pre><code class="language-go">struct MyShellTask struct {
    resource.Status

    CheckStmt string
    ApplyStmt string
}

func (t *MyShellTask) Check(resource.Renderer) (resource.TaskStatus, error) {
    // your check implementation, returning t (which embeds a TaskStatus)
}

func (t *MyShellTask) Apply() (resource.TaskStatus, error) {
    // your apply implementation, returning t (which embeds a TaskStatus)
}
</code></pre>

<h3 id="task-status">Task Status</h3>

<p>Check and Apply both return
<a href="https://godoc.org/github.com/asteris-llc/converge/resource#TaskStatus"><code>TaskStatus</code></a>.
You can implement that interface yourself, but the most common pattern is to
embed
<a href="https://godoc.org/github.com/asteris-llc/converge/resource#Status"><code>Status</code></a> in
the task itself. This is good for two reasons: first, this makes the fields on
your struct available for lookups. Second, and more importantly, <code>Status</code>
provides a number of helper methods to make your integration go more smoothly.</p>

<p><code>Status</code> has three fields: <code>Differences</code>, <code>Output</code>, and <code>Level</code>. They all have
accurate documentation on their fields, which we will not repeat here. However,
the interaction between <code>Differences</code> and <code>Level</code> deserves special mention.
These two fields are how you control execution of your Apply method. They follow
these rules:</p>

<ol>
<li>If the level is equal to
<a href="https://godoc.org/github.com/asteris-llc/converge/resource#StatusLevel"><code>resource.StatusWillChange</code></a>
or
<a href="https://godoc.org/github.com/asteris-llc/converge/resource#StatusLevel"><code>resource.StatusCantChange</code></a>,
the Status will always show up as having changes.</li>
<li>Otherwise, if there are any diffs which say that they contain a difference,
the Status will always show as having changes.</li>
</ol>

<h2 id="preparer">Preparer</h2>

<p>Before you can use your resource, it has to be deserialized from HCL. For this,
we will write a
<a href="https://godoc.org/github.com/asteris-llc/converge/resource#Resource"><code>resource.Resource</code></a>.
Resource exists to render a Task&rsquo;s fields and return it in it&rsquo;s executable
state. In our case, our Resource would look like this (they&rsquo;re typically called
<code>Preparer</code>).</p>

<pre><code class="language-go">type Preparer struct {
    Check string `hcl:&quot;check&quot;`
    Apply string `hcl:&quot;apply&quot;`
}

func (p *Preparer) Render(r *resource.Renderer) (resource.Task, error) {
    check, err := render.Render(&quot;check&quot;, p.Check)
    if err != nil {
        return nil, err
    }

    apply, err := render.Render(&quot;apply&quot;, p.Apply)
    if err != nil {
        return nil, err
    }

    return &amp;MyShellTask{CheckStmt: check, ApplyStmt: apply}, nil
}
</code></pre>

<p>&ldquo;What&rsquo;s the renderer doing there,&rdquo; you may ask, &ldquo;and how can I accept non-string
values?&rdquo; If you need to accept non-string parameters directly, the fields should
be <code>interface{}</code>s, and you should do all your type casting, conversion, and
validation in Prepare before the values are passed down to your Task.</p>

<p>The renderer is what allows your values to take input from the environment (like
calls to <code>param</code> or <code>lookup</code>.) Normally you&rsquo;ll get a string value back, but when
you get an error it is very important to return it exactly as received. Converge
will automatically wrap the errors from Render to provide context to the user
and to defer rendering of lookup nodes until they&rsquo;re resolved.</p>

<h2 id="registering">Registering</h2>

<p>The last thing you&rsquo;ll need to do is register your new resource with the loader
under it&rsquo;s HCL-usable name. To do so, call
<a href="https://godoc.org/github.com/asteris-llc/converge/load/registry#Register"><code>registry.Register</code></a>
with both the preparer and task, then empty-import your new module in
<code>load/resource.go</code>.</p>

<pre><code class="language-go">func init() {
    registry.Register(&quot;mytask&quot;, (*Preparer)(nil), (*MyShellTask)(nil))
}
</code></pre>


			<aside class="copyright" role="note">
				
				&copy; 2016 Released under the Apache 2.0 license &ndash;
				
				Documentation built with
				<a href="https://www.gohugo.io" target="_blank">Hugo</a>
				using the
				<a href="http://github.com/digitalcraftsman/hugo-material-docs" target="_blank">Material</a> theme.
			</aside>

			<footer class="footer">
				

<nav class="pagination" aria-label="Footer">
  <div class="previous">
  
      <a href="http://converge.aster.is/resources/user-group/" title="user.group">
        <span class="direction">
          Previous
        </span>
        <div class="page">
          <div class="button button-previous" role="button" aria-label="Previous">
            <i class="icon icon-back"></i>
          </div>
          <div class="stretch">
            <div class="title">
              user.group
            </div>
          </div>
        </div>
      </a>
  
  </div>

  <div class="next">
  
      <a href="http://converge.aster.is/resources/task/" title="task">
        <span class="direction">
          Next
        </span>
        <div class="page">
          <div class="stretch">
            <div class="title">
              task
            </div>
          </div>
          <div class="button button-next" role="button" aria-label="Next">
            <i class="icon icon-forward"></i>
          </div>
        </div>
      </a>
  
  </div>
</nav>





			</footer>
		</div>
	</article>

	<div class="results" role="status" aria-live="polite">
		<div class="scrollable">
			<div class="wrapper">
				<div class="meta"></div>
				<div class="list"></div>
			</div>
		</div>
	</div>
</main>

    <script>
    
      var base_url = 'http:\/\/converge.aster.is\/';
      var repo_id  = 'asteris-llc\/converge';
    
    </script>

    <script src="http://converge.aster.is/javascripts/application.js"></script>
    

    <script>
      /* Add headers to scrollspy */
      var headers   = document.getElementsByTagName("h2");
      var scrollspy = document.getElementById('scrollspy');

      if(scrollspy) {
        if(headers.length > 0) {
          for(var i = 0; i < headers.length; i++) {
            var li = document.createElement("li");
            li.setAttribute("class", "anchor");

            var a  = document.createElement("a");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", headers[i].innerHTML);
            a.innerHTML = headers[i].innerHTML;
            
            li.appendChild(a)
            scrollspy.appendChild(li);
          }
        } else {
          scrollspy.parentElement.removeChild(scrollspy)
        }
        

        /* Add permanent link next to the headers */
        var headers = document.querySelectorAll("h1, h2, h3, h4, h5, h6");

        for(var i = 0; i < headers.length; i++) {
            var a = document.createElement("a");
            a.setAttribute("class", "headerlink");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", "Permanent link")
            a.innerHTML = "#";
            headers[i].appendChild(a);
        }
      }
    </script>

    

    <script src="//gohugo.io/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>
